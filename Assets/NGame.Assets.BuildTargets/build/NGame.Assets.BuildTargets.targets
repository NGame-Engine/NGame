<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!--
  
    <ItemGroup>
      <Content Include="$(ProjectDir)$(IntermediateOutputPath)ngame/.assets/**"
               CopyToOutputDirectory="PreserveNewest"
               Link=".assets/PackageName/%(RecursiveDir)%(Filename)%(Extension)"
      />
    </ItemGroup>
  
    <Target Name="NGame_Assets_CopyToOutput" BeforeTargets="BeforeBuild">
  
      <ItemGroup>
        <NgAsset Include="**/*.ngasset" Exclude="bin/**/*;obj/**/*"/>
        <NgAsset
          Include="@(NgAsset -> '%(RelativeDir)%(FileName)')"
          Condition="Exists('%(RelativeDir)%(FileName)')"
        />
  
  
        &lt;!&ndash;      <Content Include="@(NgAsset)"
                       CopyToOutputDirectory="PreserveNewest"
                       Link=".assets/PackageName/%(RelativeDir)%(Filename)%(Extension)"
              />&ndash;&gt;
  
  
      </ItemGroup>
  
      
      <Delete Files="$(ProjectDir)$(IntermediateOutputPath)ngame/.assets/**"/>
      <Copy 
        SourceFiles="@(NgAsset)" 
        DestinationFiles="@(NgAsset -> '$(ProjectDir)$(IntermediateOutputPath)ngame/.assets/%(Identity)')"/>
  
      <Message Importance="high" Text="NGame Assets: @(NgAsset)"/>
      <Message Importance="high" Text="NGame AAA: $(ProjectDir)$(IntermediateOutputPath)ngame/.assets/"/>
    </Target>
  
  -->

  <!-- 
  AssignProjectConfiguration
  ProcessFrameworkReferences
  ResolvePackageAssets
  -->

  <!--
    <Target Name="NGame_Assets_BeforeBuild" BeforeTargets="BeforeBuild">
      <CallTarget Targets="NGame_Assets_UpdateContent"/>
    </Target>
  -->


  <Target Name="NGame_Assets_ReadProjectInfo">

    <PropertyGroup>
      <NgAssetListPath>$(ProjectDir)$(BaseIntermediateOutputPath)ngame/NGameAssets.g.txt</NgAssetListPath>
    </PropertyGroup>

    <ItemGroup>
      <NgAsset Include="**/*.ngasset" Exclude="bin/**/*;obj/**/*"/>
      <NgAsset
        Include="@(NgAsset -> '%(RelativeDir)%(FileName)')"
        Condition="Exists('%(RelativeDir)%(FileName)')"
      />
    </ItemGroup>

    <Message Text="NGame Assets in Project: @(NgAsset)"/>

  </Target>


  <Target
    Name="NGame_Assets_UpdateContent"
    BeforeTargets="BeforeBuild"
    DependsOnTargets="NGame_Assets_ReadProjectInfo"
    Inputs="@(NgAsset)"
    Outputs="$(NgAssetListPath)"
  >
    <WriteLinesToFile
      Lines="@(NgAsset -> '$(ProjectDir)//%(RelativeDir)%(Filename)%(Extension)')"
      File="$(NgAssetListPath)"
      Overwrite="true"
      Encoding="Unicode"/>

    <Message Importance="high" Text="Updated NGame Asset List"/>
  </Target>


  <!--
  
    <Target Name="NGame_AssignPropertiesForAssets">
      <PropertyGroup>
        <NgAppsettingsPath>$(ProjectDir)appsettings.json</NgAppsettingsPath>
        <NGAssetListFile>$(ProjectDir)$(IntermediateOutputPath)ngame/NGAssets.g.txt</NGAssetListFile>
        <NgUsedAssetListFile>$(ProjectDir)$(IntermediateOutputPath)ngame/NGAssets.used.g.txt</NgUsedAssetListFile>
      </PropertyGroup>
    </Target>
  
  
    <Target Name="DeleteNGAssetListFile"
            BeforeTargets="BeforeRebuild"
            DependsOnTargets="NGame_AssignPropertiesForAssets">
      <Delete Files="$(NGAssetListFile)"/>
    </Target>
  
  
    <Target Name="DeleteNGAssetListFile"
            BeforeTargets="BeforeClean"
            DependsOnTargets="NGame_AssignPropertiesForAssets">
      <Delete Files="$(NGAssetListFile)"/>
    </Target>
  
  
    <Target
      Name="NGame_UpdateAssets"
      BeforeTargets="BeforeBuild"
      DependsOnTargets="NGame_AssignPropertiesForAssets"
    >
      <CallTarget Targets="NGame_UpdateAssets_UpdateItemGroupNgAsset"/>
      <CallTarget Targets="NGame_UpdateAssets_UpdateAssetList"/>
  
      <CallTarget Targets="NGame_UpdateAssets_UpdateItemGroupNgAssetLists"/>
      <CallTarget
        Targets="NGame_UpdateAssets_UpdateUsedAssetList"
        Condition="Exists('$(NgAppsettingsPath)')"
      />
    </Target>
  
  
    <Target Name="NGame_UpdateAssets_UpdateItemGroupNgAsset">
      <ItemGroup>
        <NgAsset Include="**/*.ngasset" Exclude="bin/**/*;obj/**/*"/>
        <NgAsset
          Include="@(NgAsset -> '%(RelativeDir)%(FileName)')"
          Condition="Exists('%(RelativeDir)%(FileName)')"
        />
      </ItemGroup>
    </Target>
  
  
    <Target Name="NGame_UpdateAssets_UpdateAssetList"
            Inputs="@(NgAsset)"
            Outputs="$(NGAssetListFile)">
      <Message Text="NGame: Updating asset list for this project..."/>
      <WriteLinesToFile
        Lines="@(NgAsset -> '$(NGAssetPackName)//$(ProjectDir)%(Identity)')"
        File="$(NGAssetListFile)"
        Overwrite="true"
        Encoding="Unicode"/>
      <Message Text="NGame: Asset list updated for this project."/>
    </Target>
  
  
    <Target Name="NGame_UpdateAssets_UpdateItemGroupNgAssetLists">
      <ItemGroup>
        <NgAssetLists Include="$(SolutionDir)**/$(NGAssetListFile)"/>
      </ItemGroup>
    </Target>
  
  
    <Target Name="NGame_UpdateAssets_UpdateUsedAssetList"
            Inputs="@(NgAssetLists)"
            Outputs="$(NgUsedAssetListFile)">
      <Message Text="NGame: Update list of used assets..."/>
  
      <Exec Command="dotnet tool list NGame.Assets.UsageDetector" IgnoreExitCode="true">
        <Output TaskParameter="ExitCode" PropertyName="PackageMissing"/>
      </Exec>
  
      <Exec Condition="$(PackageMissing)==1"
            Command="dotnet tool install NGame.Assets.UsageDetector ^
      &#45;&#45;version 0.0.2-dev ^
      &#45;&#45;create-manifest-if-needed"/>
  
      <Exec Command="dotnet tool update NGame.Assets.UsageDetector &#45;&#45;version 0.0.8"/>
  
      <Exec Command="dotnet tool run ngame-asset-usages ^
      solutiondir=&quot;$(SolutionDir) &quot; ^
      appsettings=&quot;$(NgAppsettingsPath)&quot; ^
      output=&quot;$(NgUsedAssetListFile)&quot;"/>
  
      <Message Text="NGame:  List of used assets updated."/>
    </Target>
  -->


</Project>
